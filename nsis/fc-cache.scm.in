#!/usr/bin/guile \
-e main -s
!#

(use-modules
 (srfi srfi-13))

(define (re-sub re sub string)
  (regexp-substitute/global #f re string 'pre sub 'post))

(define (main args)
  (let* ((files (cdr args))
	 (instdir "@SLASHED_INSTDIR@")
	 (fonts.conf (string-append instdir "/usr/etc/fonts/fonts.conf"))
	 (fc-cache.exe (string-append instdir "/usr/bin/fc-cache.exe"))
	 (env "FONTCONFIG_FILE")
	 (exec-args (append  (list fc-cache.exe "--verbose") files))
	 )

    (setenv env fonts.conf)
    (display (getenv env))
    (newline)
    (write exec-args (current-output-port))
    (newline)
    (force-output (current-output-port))
    (apply execl exec-args)))


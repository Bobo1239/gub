# -*-shell-script-*-

[Meta]
SoftwareVersion: @VERSION@
RootName: @lilypond.org/lilypond:$SOFTWAREVERSION
DisplayName: LilyPond
DisplayName[nl]: LilyPond
ShortName: lilypond
Maintainer: LilyPond Development team - http://lilypond.org
Packager: Jan Nieuwenhuizen <janneke@gnu.org>
Summary: Create and print beautiful music notation 
Summary[nl]: Maak en druk prachtige bladmuziek
PackageVersion: 0
InterfaceVersion: 0
AutopackageTarget: 1.0

[Description]
LilyPond lets you create music notation.  It produces
beautiful sheet music from a high-level description file.

[BuildPrepare]
export PREFIX=/usr
tar -cf- --exclude autopackage . | tar -C $build_root -xvf-

[BuildUnprepare]
unprepareBuild

[Imports]
# Remove symlinks that confuse copyFiles
rm share/lilypond/@VERSION@/tex/enc
rm share/lilypond/@VERSION@/dvips/map

echo '*' | import


[Prepare]
echo Prepare

[Install]
 export PREFIX=/usr
installExe bin/*

mkdirs "$PREFIX/share/info/lilypond/"
copyFiles info/lilypond/* "$PREFIX/share/info/lilypond"
	
mkdirs "$PREFIX/share/man/man1/"
installMan 1 man/man1/*

mkdirs "$PREFIX/share/locale/"
installLocale share/locale

# share/lilypond/x.y.z is a large folder.  Copying it will take a long time.
# Copy the subfolders and notify the user with a progress bar.
dirs=(fonts images ly ps python misc scm tex vim)
i=1
max=${#dirs[@]}

mkdirs "$PREFIX/share/lilypond/@VERSION@/"
for D in "${dirs[@]}"; do
    progressBar $i $max "$(gettext autopackage 'Installing data files...')"
    copyFiles --silent "share/lilypond/@VERSION@/$D"/* "$PREFIX/share/lilypond/@VERSION@/$D"
    (( i++ ))
done

mkdirs "$PREFIX/share/lilypond/@VERSION@/dvips"
(cd "$PREFIX/share/lilypond/@VERSION@/dvips"; ln -fs ../fonts/map .)
mkdirs "$PREFIX/share/lilypond/@VERSION@/tex"
(cd "$PREFIX/share/lilypond/@VERSION@/tex"; ln -fs ../fonts/enc .)

# FIXME: use progress indication
copyFiles "lib/lilypond/@VERSION@" "$PREFIX/lib/lilypond/@VERSION@"

[Uninstall]
uninstallFromLog
rm -rf "$PREFIX/share/lilypond/@VERSION@/tex"
rm -rf "$PREFIX/share/lilypond/@VERSION@/dvips"
